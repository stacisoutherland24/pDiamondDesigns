<div class="favorites-container">
     <div class="favorites-header">
          <h1>My Favorites</h1>
          <div class="header-actions" *ngIf="favoriteProducts.length > 0">
               <button class="email-order-btn" (click)="openEmailForm()">
                    <span class="btn-main"><i class="bi bi-envelope"></i> Email This Order</span>
                    <span class="btn-subtext">Add quantities in next step</span>
               </button>
               <button class="clear-all-btn" (click)="clearAllFavorites()">
                    Clear All Favorites
               </button>
          </div>
     </div>

     <div class="favorites-grid" *ngIf="favoriteProducts.length > 0">
          <div class="favorite-item" *ngFor="let product of favoriteProducts">
               <!-- Product Image Container -->
               <div class="product-image" (click)="navigateToProduct(product._id)">
                    <img [src]="product.images?.[0]?.asset?.url" [alt]="product.title"
                         onerror="this.src='assets/placeholder-image.jpg'" />

                    <!-- Remove Favorite Button (replaces heart overlay) -->
                    <button class="remove-favorite-btn" (click)="removeFavorite(product._id); $event.stopPropagation()"
                         title="Remove from favorites">
                         <i class="bi bi-heart-fill text-danger"></i>
                    </button>
               </div>

               <!-- Product Information -->
               <div class="product-info" (click)="navigateToProduct(product._id)">
                    <h3>{{ product.title }}</h3>
                    <p class="product-description">{{ product.description || 'No description available.' }}</p>
                    <span class="price">${{ product.price }}</span>
               </div>

               <!-- Add to Cart Button -->
               <!-- <div class="product-actions">
                    <button class="add-to-cart-btn" (click)="addToCart(product); $event.stopPropagation()">
                         <i class="bi bi-cart-plus"></i> Add to Cart
                    </button>
               </div> -->
          </div>
     </div>

     <div class="empty-favorites" *ngIf="favoriteProducts.length === 0">
          <i class="bi bi-heart"></i>
          <h3>No favorites yet</h3>
          <p>Start browsing our wholesale catalog to add items to your favorites!</p>
          <a routerLink="/wholesale" class="browse-btn">Wholesale Catalog</a>
     </div>

     <div class="loading" *ngIf="loading">
          Loading your favorites...
     </div>
</div>

<!-- Email Order Modal -->
<div class="email-modal-overlay" *ngIf="showEmailForm" (click)="closeEmailForm()">
     <div class="email-modal" (click)="$event.stopPropagation()">
          <button class="close-modal-btn" (click)="closeEmailForm()">
               <i class="bi bi-x-lg"></i>
          </button>

          <h2>Send Wholesale Order</h2>

          <!-- Success Message -->
          <div class="email-success" *ngIf="emailSuccess">
               <i class="bi bi-check-circle"></i>
               <p>Your wholesale order has been sent successfully!</p>
          </div>

          <!-- Error Message -->
          <div class="email-error" *ngIf="emailError">
               <i class="bi bi-exclamation-circle"></i>
               <p>Failed to send email. Please try again.</p>
          </div>

          <!-- Email Form -->
          <form *ngIf="!emailSuccess" (ngSubmit)="sendEmailOrder()">
               <div class="form-group">
                    <label for="customerName">Your Name *</label>
                    <input type="text" id="customerName" [(ngModel)]="customerName" name="customerName" required
                         placeholder="Enter your name" />
               </div>

               <div class="form-group">
                    <label for="customerEmail">Your Email *</label>
                    <input type="email" id="customerEmail" [(ngModel)]="customerEmail" name="customerEmail" required
                         placeholder="Enter your email" />
               </div>

               <div class="form-group">
                    <label for="customerMessage">Additional Message (Optional)</label>
                    <textarea id="customerMessage" [(ngModel)]="customerMessage" name="customerMessage" rows="3"
                         placeholder="Any special requests or questions?"></textarea>
               </div>

               <!-- Order Summary -->
               <div class="order-summary">
                    <h3>Items in this order ({{ getTotalItems() }} items)</h3>
                    <ul>
                         <ng-container *ngFor="let product of favoriteProducts">
                              <li class="order-item" *ngIf="!isRemovedFromOrder(product._id)">
                                   <button type="button" class="remove-item-btn" (click)="removeFromOrder(product._id)" title="Remove from order">
                                        <i class="bi bi-x"></i>
                                   </button>
                                   <div class="item-image">
                                        <img [src]="product.images?.[0]?.asset?.url" [alt]="product.title"
                                             onerror="this.src='assets/placeholder-image.jpg'" />
                                   </div>
                                   <div class="item-details">
                                        <span class="item-name">{{ product.title }}</span>
                                        <span class="item-description" *ngIf="product.description">{{ product.description }}</span>
                                        <span class="item-price">${{ product.price }}</span>
                                   </div>
                                   <div class="quantity-controls">
                                        <button type="button" class="qty-btn" (click)="updateQuantity(product._id, getQuantity(product._id) - 1)" [disabled]="getQuantity(product._id) <= 1">
                                             <i class="bi bi-dash"></i>
                                        </button>
                                        <input type="number" [value]="getQuantity(product._id)" (change)="updateQuantity(product._id, $any($event.target).value)" min="1" class="qty-input" />
                                        <button type="button" class="qty-btn" (click)="updateQuantity(product._id, getQuantity(product._id) + 1)">
                                             <i class="bi bi-plus"></i>
                                        </button>
                                   </div>
                              </li>
                         </ng-container>
                    </ul>
                    <div class="order-total">
                         <strong>Total estimated cost: ${{ getOrderTotal().toFixed(2) }}</strong>
                         <p class="text-left">Disclaimer - Price on products are subject to change due to the rising market costs of product materials. Please
                              contact <a href="mailto:kerry&#64;pdiamonddesigns.com">kerry&#64;pdiamonddesigns.com</a> for final invoice cost.</p>
                    </div>
               </div>

               <button type="submit" class="send-email-btn" [disabled]="emailSending || !customerName || !customerEmail">
                    <span *ngIf="!emailSending">
                         <i class="bi bi-send"></i> Send Order
                    </span>
                    <span *ngIf="emailSending">
                         <i class="bi bi-hourglass-split"></i> Sending...
                    </span>
               </button>
          </form>
     </div>
</div>
